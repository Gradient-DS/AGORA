{
  "description": "Error handling examples using AG-UI Protocol",
  "examples": [
    {
      "name": "Moderation Violation",
      "description": "Server detects content moderation issue",
      "events": [
        {
          "direction": "client → server",
          "event": {
            "threadId": "abc123-def456-789",
            "runId": "run-003",
            "messages": [
              {
                "role": "user",
                "content": "[inappropriate content]"
              }
            ]
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "RUN_STARTED",
            "threadId": "abc123-def456-789",
            "runId": "run-003",
            "timestamp": "2025-01-15T10:30:00.000Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "CUSTOM",
            "name": "agora:error",
            "value": {
              "errorCode": "moderation_violation",
              "message": "Your message contains content that violates our guidelines",
              "details": {
                "reason": "profanity",
                "severity": "medium"
              }
            },
            "timestamp": "2025-01-15T10:30:00.100Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "RUN_FINISHED",
            "threadId": "abc123-def456-789",
            "runId": "run-003",
            "timestamp": "2025-01-15T10:30:00.200Z"
          }
        }
      ]
    },
    {
      "name": "Tool Execution Error",
      "description": "Tool fails during execution",
      "events": [
        {
          "direction": "client → server",
          "event": {
            "threadId": "abc123-def456-789",
            "runId": "run-004",
            "messages": [
              {
                "role": "user",
                "content": "Search for regulations about HACCP"
              }
            ]
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "RUN_STARTED",
            "threadId": "abc123-def456-789",
            "runId": "run-004",
            "timestamp": "2025-01-15T10:30:00.000Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "STEP_STARTED",
            "stepName": "executing_tools",
            "metadata": { "tool": "search_regulations" },
            "timestamp": "2025-01-15T10:30:00.500Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TOOL_CALL_START",
            "toolCallId": "call-search-001",
            "toolCallName": "search_regulations",
            "timestamp": "2025-01-15T10:30:00.600Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TOOL_CALL_ARGS",
            "toolCallId": "call-search-001",
            "delta": "{\"query\": \"HACCP\", \"limit\": 10}",
            "timestamp": "2025-01-15T10:30:00.700Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TOOL_CALL_END",
            "toolCallId": "call-search-001",
            "error": "Database connection timeout after 30 seconds",
            "timestamp": "2025-01-15T10:30:30.700Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "STEP_FINISHED",
            "stepName": "executing_tools",
            "timestamp": "2025-01-15T10:30:30.800Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_START",
            "messageId": "msg-error-001",
            "role": "assistant",
            "timestamp": "2025-01-15T10:30:30.900Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_CONTENT",
            "messageId": "msg-error-001",
            "delta": "I apologize, but I encountered an error while searching the regulations database. Please try again in a moment.",
            "timestamp": "2025-01-15T10:30:31.000Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_END",
            "messageId": "msg-error-001",
            "timestamp": "2025-01-15T10:30:31.100Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "RUN_FINISHED",
            "threadId": "abc123-def456-789",
            "runId": "run-004",
            "timestamp": "2025-01-15T10:30:31.200Z"
          }
        }
      ]
    },
    {
      "name": "Tool Approval Rejected",
      "description": "User rejects a tool approval request",
      "events": [
        {
          "direction": "server → client",
          "event": {
            "type": "CUSTOM",
            "name": "agora:tool_approval_request",
            "value": {
              "toolName": "delete_inspection_record",
              "toolDescription": "Permanently deletes an inspection record from the system",
              "parameters": {
                "inspection_id": "INS-2024-001"
              },
              "reasoning": "User requested to delete the inspection record",
              "riskLevel": "critical",
              "approvalId": "appr-delete-001"
            },
            "timestamp": "2025-01-15T10:30:01.000Z"
          }
        },
        {
          "direction": "client → server",
          "event": {
            "type": "CUSTOM",
            "name": "agora:tool_approval_response",
            "value": {
              "approvalId": "appr-delete-001",
              "approved": false,
              "feedback": "I don't want to delete this record"
            }
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_START",
            "messageId": "msg-cancel-001",
            "role": "assistant",
            "timestamp": "2025-01-15T10:30:02.000Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_CONTENT",
            "messageId": "msg-cancel-001",
            "delta": "I have cancelled the deletion as requested. The inspection record INS-2024-001 remains unchanged.",
            "timestamp": "2025-01-15T10:30:02.100Z"
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_END",
            "messageId": "msg-cancel-001",
            "timestamp": "2025-01-15T10:30:02.200Z"
          }
        }
      ]
    }
  ]
}
