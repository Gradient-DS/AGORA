{
  "description": "Error handling scenarios using AG-UI Protocol v2.5.0",
  "scenarios": [
    {
      "name": "Run Error (Official Event)",
      "description": "Using the official RUN_ERROR event type for processing errors",
      "events": [
        {
          "direction": "client → server",
          "event": {
            "threadId": "abc123-def456-789",
            "userId": "550e8400-e29b-41d4-a716-446655440001",
            "messages": [
              {
                "role": "user",
                "content": "Process this request"
              }
            ]
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "RUN_STARTED",
            "threadId": "abc123-def456-789",
            "runId": "run-error-001",
            "timestamp": 1705318200000
          }
        },
        {
          "direction": "server → client",
          "description": "Initial state snapshot",
          "event": {
            "type": "STATE_SNAPSHOT",
            "snapshot": {
              "threadId": "abc123-def456-789",
              "runId": "run-error-001",
              "currentAgent": "general-agent",
              "status": "processing"
            },
            "timestamp": 1705318200050
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "STEP_STARTED",
            "stepName": "thinking",
            "timestamp": 1705318200100
          }
        },
        {
          "direction": "server → client",
          "description": "Official RUN_ERROR event for processing failures",
          "event": {
            "type": "RUN_ERROR",
            "message": "Error processing message: LLM rate limit exceeded",
            "code": "processing_error",
            "timestamp": 1705318200500
          }
        },
        {
          "direction": "server → client",
          "description": "RUN_FINISHED is always sent, even after errors",
          "event": {
            "type": "RUN_FINISHED",
            "threadId": "abc123-def456-789",
            "runId": "run-error-001",
            "timestamp": 1705318200600
          }
        }
      ]
    },
    {
      "name": "AGORA Custom Error (Moderation)",
      "description": "Using CUSTOM event for AGORA-specific errors like moderation violations",
      "events": [
        {
          "direction": "client → server",
          "event": {
            "threadId": "abc123-def456-789",
            "userId": "550e8400-e29b-41d4-a716-446655440001",
            "messages": [
              {
                "role": "user",
                "content": "[inappropriate content]"
              }
            ]
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "RUN_STARTED",
            "threadId": "abc123-def456-789",
            "runId": "run-mod-001",
            "timestamp": 1705318200000
          }
        },
        {
          "direction": "server → client",
          "description": "AGORA-specific error via CUSTOM event for moderation violations",
          "event": {
            "type": "CUSTOM",
            "name": "agora:error",
            "value": {
              "errorCode": "moderation_violation",
              "message": "Your message contains prohibited content and cannot be processed",
              "details": {
                "reason": "content_policy_violation",
                "category": "inappropriate_language"
              }
            },
            "timestamp": 1705318200100
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "RUN_FINISHED",
            "threadId": "abc123-def456-789",
            "runId": "run-mod-001",
            "timestamp": 1705318200200
          }
        }
      ]
    },
    {
      "name": "Tool Approval Rejected",
      "description": "User rejects a tool execution request",
      "events": [
        {
          "direction": "server → client",
          "description": "Server requests approval for a dangerous operation",
          "event": {
            "type": "CUSTOM",
            "name": "agora:tool_approval_request",
            "value": {
              "toolName": "delete_records",
              "toolDescription": "Permanently deletes inspection records from the database",
              "parameters": {
                "recordIds": ["REC-001", "REC-002"]
              },
              "reasoning": "User requested to clean up old records",
              "riskLevel": "critical",
              "approvalId": "appr-reject-001"
            },
            "timestamp": 1705318201000
          }
        },
        {
          "direction": "client → server",
          "description": "User rejects the dangerous operation",
          "event": {
            "type": "CUSTOM",
            "name": "agora:tool_approval_response",
            "value": {
              "approvalId": "appr-reject-001",
              "approved": false,
              "feedback": "I don't want to delete these records"
            }
          }
        },
        {
          "direction": "server → client",
          "description": "Server transitions back to thinking after rejection",
          "event": {
            "type": "STEP_FINISHED",
            "stepName": "executing_tools",
            "timestamp": 1705318201500
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "STEP_STARTED",
            "stepName": "thinking",
            "timestamp": 1705318201550
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_START",
            "messageId": "msg-cancel-001",
            "role": "assistant",
            "timestamp": 1705318202000
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_CONTENT",
            "messageId": "msg-cancel-001",
            "delta": "I have cancelled the action as requested.",
            "timestamp": 1705318202100
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "TEXT_MESSAGE_END",
            "messageId": "msg-cancel-001",
            "timestamp": 1705318202200
          }
        },
        {
          "direction": "server → client",
          "event": {
            "type": "STEP_FINISHED",
            "stepName": "thinking",
            "timestamp": 1705318202300
          }
        }
      ]
    }
  ]
}
