{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "agora-ag-ui-events",
  "title": "AGORA AG-UI Protocol Events v2.5.0",
  "description": "JSON Schema definitions for AG-UI Protocol events and REST API types used by AGORA. Uses official ag-ui-protocol types with AGORA extensions for session management and conversation history.",
  "definitions": {
    "SessionMetadata": {
      "type": "object",
      "description": "Metadata for a conversation session",
      "required": ["sessionId", "userId", "title", "messageCount", "createdAt", "lastActivity"],
      "properties": {
        "sessionId": {
          "type": "string",
          "description": "Unique session identifier (same as threadId)"
        },
        "userId": {
          "type": "string",
          "description": "Inspector persona ID (e.g., 'koen', 'fatima')"
        },
        "title": {
          "type": "string",
          "description": "Auto-generated title from first message"
        },
        "firstMessagePreview": {
          "type": ["string", "null"],
          "description": "Preview of the first message (truncated)"
        },
        "messageCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of messages in the session"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Session creation timestamp (ISO 8601)"
        },
        "lastActivity": {
          "type": "string",
          "format": "date-time",
          "description": "Last message timestamp (ISO 8601)"
        }
      }
    },
    "SessionListResponse": {
      "type": "object",
      "description": "Response for GET /sessions endpoint",
      "required": ["success", "sessions", "totalCount"],
      "properties": {
        "success": { "type": "boolean" },
        "sessions": {
          "type": "array",
          "items": { "$ref": "#/definitions/SessionMetadata" }
        },
        "totalCount": {
          "type": "integer",
          "description": "Total number of sessions for pagination"
        }
      }
    },
    "HistoryMessage": {
      "type": "object",
      "description": "A message in conversation history (role determines available fields)",
      "required": ["role", "content"],
      "properties": {
        "role": {
          "type": "string",
          "enum": ["user", "assistant", "tool_call", "tool"],
          "description": "Message role: user, assistant, tool_call (invocation), or tool (result)"
        },
        "content": {
          "type": "string",
          "description": "Message content (for tool_call: JSON args, for tool: result)"
        },
        "agent_id": {
          "type": ["string", "null"],
          "description": "Agent that produced this message (for assistant and tool_call)"
        },
        "tool_call_id": {
          "type": ["string", "null"],
          "description": "Tool call identifier (for tool_call and tool roles)"
        },
        "tool_name": {
          "type": ["string", "null"],
          "description": "Name of the tool (for tool_call and tool roles)"
        },
        "spoken_text": {
          "type": ["string", "null"],
          "description": "TTS-optimized version of the content (assistant messages only)"
        }
      }
    },
    "HistoryResponse": {
      "type": "object",
      "description": "Response for GET /sessions/{id}/history endpoint",
      "required": ["success", "threadId", "history", "messageCount"],
      "properties": {
        "success": { "type": "boolean" },
        "threadId": {
          "type": "string",
          "description": "Session/thread identifier"
        },
        "history": {
          "type": "array",
          "items": { "$ref": "#/definitions/HistoryMessage" }
        },
        "messageCount": {
          "type": "integer",
          "description": "Number of messages in history"
        }
      }
    },
    "EventType": {
      "type": "string",
      "enum": [
        "RUN_STARTED",
        "RUN_FINISHED",
        "RUN_ERROR",
        "STEP_STARTED",
        "STEP_FINISHED",
        "TEXT_MESSAGE_START",
        "TEXT_MESSAGE_CONTENT",
        "TEXT_MESSAGE_END",
        "TOOL_CALL_START",
        "TOOL_CALL_ARGS",
        "TOOL_CALL_END",
        "TOOL_CALL_RESULT",
        "STATE_SNAPSHOT",
        "STATE_DELTA",
        "MESSAGES_SNAPSHOT",
        "CUSTOM",
        "RAW"
      ]
    },
    "RiskLevel": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"]
    },
    "MessageRole": {
      "type": "string",
      "enum": ["user", "assistant", "system", "tool", "developer"]
    },
    "Message": {
      "type": "object",
      "required": ["role", "content"],
      "properties": {
        "id": { "type": "string" },
        "role": { "$ref": "#/definitions/MessageRole" },
        "content": { "type": "string" },
        "toolCallId": { "type": "string" }
      }
    },
    "RunAgentInput": {
      "type": "object",
      "required": ["threadId", "messages", "userId"],
      "properties": {
        "threadId": { "type": "string", "description": "Thread/session identifier" },
        "runId": { "type": "string", "description": "Optional unique run identifier (auto-generated if not provided)" },
        "userId": {
          "type": "string",
          "format": "uuid",
          "description": "User ID that owns this session (AGORA extension to AG-UI protocol)"
        },
        "messages": {
          "type": "array",
          "items": { "$ref": "#/definitions/Message" }
        },
        "context": { "type": "object", "description": "Additional context" }
      }
    },
    "RunStartedEvent": {
      "type": "object",
      "required": ["type", "threadId", "runId"],
      "properties": {
        "type": { "const": "RUN_STARTED" },
        "threadId": { "type": "string" },
        "runId": { "type": "string" },
        "parentRunId": { "type": "string" },
        "timestamp": { "type": "integer", "description": "Unix timestamp in milliseconds" }
      }
    },
    "RunFinishedEvent": {
      "type": "object",
      "required": ["type", "threadId", "runId"],
      "properties": {
        "type": { "const": "RUN_FINISHED" },
        "threadId": { "type": "string" },
        "runId": { "type": "string" },
        "result": { "type": ["object", "null"] },
        "timestamp": { "type": "integer" }
      }
    },
    "RunErrorEvent": {
      "type": "object",
      "required": ["type", "message"],
      "properties": {
        "type": { "const": "RUN_ERROR" },
        "message": { "type": "string" },
        "code": { "type": ["string", "null"] },
        "timestamp": { "type": "integer" }
      }
    },
    "StepStartedEvent": {
      "type": "object",
      "required": ["type", "stepName"],
      "properties": {
        "type": { "const": "STEP_STARTED" },
        "stepName": { "type": "string" },
        "timestamp": { "type": "integer" }
      }
    },
    "StepFinishedEvent": {
      "type": "object",
      "required": ["type", "stepName"],
      "properties": {
        "type": { "const": "STEP_FINISHED" },
        "stepName": { "type": "string" },
        "timestamp": { "type": "integer" }
      }
    },
    "TextMessageStartEvent": {
      "type": "object",
      "required": ["type", "messageId", "role"],
      "properties": {
        "type": { "const": "TEXT_MESSAGE_START" },
        "messageId": { "type": "string" },
        "role": { "type": "string", "enum": ["user", "assistant", "developer", "system"] },
        "timestamp": { "type": "integer" }
      }
    },
    "TextMessageContentEvent": {
      "type": "object",
      "required": ["type", "messageId", "delta"],
      "properties": {
        "type": { "const": "TEXT_MESSAGE_CONTENT" },
        "messageId": { "type": "string" },
        "delta": { "type": "string", "minLength": 1 },
        "timestamp": { "type": "integer" }
      }
    },
    "TextMessageEndEvent": {
      "type": "object",
      "required": ["type", "messageId"],
      "properties": {
        "type": { "const": "TEXT_MESSAGE_END" },
        "messageId": { "type": "string" },
        "timestamp": { "type": "integer" }
      }
    },
    "ToolCallStartEvent": {
      "type": "object",
      "required": ["type", "toolCallId", "toolCallName"],
      "properties": {
        "type": { "const": "TOOL_CALL_START" },
        "toolCallId": { "type": "string" },
        "toolCallName": { "type": "string" },
        "toolDescription": {
          "type": ["string", "null"],
          "description": "Human-readable spoken description of the tool action for TTS"
        },
        "toolDisplayName": {
          "type": ["string", "null"],
          "description": "Human-readable display name for UI rendering"
        },
        "parentMessageId": { "type": ["string", "null"] },
        "timestamp": { "type": "integer" }
      }
    },
    "ToolCallArgsEvent": {
      "type": "object",
      "required": ["type", "toolCallId", "delta"],
      "properties": {
        "type": { "const": "TOOL_CALL_ARGS" },
        "toolCallId": { "type": "string" },
        "delta": { "type": "string" },
        "timestamp": { "type": "integer" }
      }
    },
    "ToolCallEndEvent": {
      "type": "object",
      "required": ["type", "toolCallId"],
      "properties": {
        "type": { "const": "TOOL_CALL_END" },
        "toolCallId": { "type": "string" },
        "timestamp": { "type": "integer" }
      }
    },
    "ToolCallResultEvent": {
      "type": "object",
      "required": ["type", "messageId", "toolCallId", "content"],
      "properties": {
        "type": { "const": "TOOL_CALL_RESULT" },
        "messageId": { "type": "string" },
        "toolCallId": { "type": "string" },
        "content": { "type": "string" },
        "role": { "const": "tool" },
        "timestamp": { "type": "integer" }
      }
    },
    "StateSnapshotEvent": {
      "type": "object",
      "required": ["type", "snapshot"],
      "properties": {
        "type": { "const": "STATE_SNAPSHOT" },
        "snapshot": { "type": "object" },
        "timestamp": { "type": "integer" }
      }
    },
    "StateDeltaEvent": {
      "type": "object",
      "required": ["type", "delta"],
      "properties": {
        "type": { "const": "STATE_DELTA" },
        "delta": { "type": "array", "description": "JSON Patch (RFC 6902) operations" },
        "timestamp": { "type": "integer" }
      }
    },
    "MessagesSnapshotEvent": {
      "type": "object",
      "required": ["type", "messages"],
      "properties": {
        "type": { "const": "MESSAGES_SNAPSHOT" },
        "messages": { "type": "array", "items": { "$ref": "#/definitions/Message" } },
        "timestamp": { "type": "integer" }
      }
    },
    "CustomEvent": {
      "type": "object",
      "required": ["type", "name", "value"],
      "properties": {
        "type": { "const": "CUSTOM" },
        "name": { "type": "string" },
        "value": {},
        "timestamp": { "type": "integer" }
      }
    },
    "RawEvent": {
      "type": "object",
      "required": ["type", "event"],
      "properties": {
        "type": { "const": "RAW" },
        "event": {},
        "source": { "type": ["string", "null"] },
        "timestamp": { "type": "integer" }
      }
    },
    "ToolApprovalRequestPayload": {
      "type": "object",
      "description": "Payload for agora:tool_approval_request custom event",
      "required": ["toolName", "toolDescription", "parameters", "reasoning", "riskLevel", "approvalId"],
      "properties": {
        "toolName": { "type": "string" },
        "toolDescription": { "type": "string" },
        "parameters": { "type": "object" },
        "reasoning": { "type": "string" },
        "riskLevel": { "$ref": "#/definitions/RiskLevel" },
        "approvalId": { "type": "string" }
      }
    },
    "ToolApprovalResponsePayload": {
      "type": "object",
      "description": "Payload for agora:tool_approval_response custom event",
      "required": ["approvalId", "approved"],
      "properties": {
        "approvalId": { "type": "string" },
        "approved": { "type": "boolean" },
        "feedback": { "type": ["string", "null"] }
      }
    },
    "ErrorPayload": {
      "type": "object",
      "description": "Payload for agora:error custom event",
      "required": ["errorCode", "message"],
      "properties": {
        "errorCode": { "type": "string" },
        "message": { "type": "string" },
        "details": { "type": ["object", "null"] }
      }
    }
  },
  "oneOf": [
    { "$ref": "#/definitions/RunStartedEvent" },
    { "$ref": "#/definitions/RunFinishedEvent" },
    { "$ref": "#/definitions/RunErrorEvent" },
    { "$ref": "#/definitions/StepStartedEvent" },
    { "$ref": "#/definitions/StepFinishedEvent" },
    { "$ref": "#/definitions/TextMessageStartEvent" },
    { "$ref": "#/definitions/TextMessageContentEvent" },
    { "$ref": "#/definitions/TextMessageEndEvent" },
    { "$ref": "#/definitions/ToolCallStartEvent" },
    { "$ref": "#/definitions/ToolCallArgsEvent" },
    { "$ref": "#/definitions/ToolCallEndEvent" },
    { "$ref": "#/definitions/ToolCallResultEvent" },
    { "$ref": "#/definitions/StateSnapshotEvent" },
    { "$ref": "#/definitions/StateDeltaEvent" },
    { "$ref": "#/definitions/MessagesSnapshotEvent" },
    { "$ref": "#/definitions/CustomEvent" },
    { "$ref": "#/definitions/RawEvent" }
  ]
}
