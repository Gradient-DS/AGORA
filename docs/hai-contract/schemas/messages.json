{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "agora-ag-ui-events",
  "title": "AGORA AG-UI Protocol Events",
  "description": "JSON Schema definitions for AG-UI Protocol events used by AGORA",
  "definitions": {
    "EventType": {
      "type": "string",
      "enum": [
        "RUN_STARTED",
        "RUN_FINISHED",
        "STEP_STARTED",
        "STEP_FINISHED",
        "TEXT_MESSAGE_START",
        "TEXT_MESSAGE_CONTENT",
        "TEXT_MESSAGE_END",
        "TOOL_CALL_START",
        "TOOL_CALL_ARGS",
        "TOOL_CALL_END",
        "STATE_SNAPSHOT",
        "STATE_DELTA",
        "MESSAGES_SNAPSHOT",
        "CUSTOM",
        "RAW"
      ]
    },
    "RiskLevel": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"]
    },
    "MessageRole": {
      "type": "string",
      "enum": ["user", "assistant", "system", "tool"]
    },
    "Message": {
      "type": "object",
      "required": ["role", "content"],
      "properties": {
        "role": { "$ref": "#/definitions/MessageRole" },
        "content": { "type": "string" },
        "id": { "type": "string" },
        "toolCallId": { "type": "string" }
      }
    },
    "RunAgentInput": {
      "type": "object",
      "required": ["threadId", "messages"],
      "properties": {
        "threadId": { "type": "string" },
        "runId": { "type": "string" },
        "messages": {
          "type": "array",
          "items": { "$ref": "#/definitions/Message" }
        },
        "context": { "type": "object" }
      }
    },
    "RunStartedEvent": {
      "type": "object",
      "required": ["type", "threadId", "runId"],
      "properties": {
        "type": { "const": "RUN_STARTED" },
        "threadId": { "type": "string" },
        "runId": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "RunFinishedEvent": {
      "type": "object",
      "required": ["type", "threadId", "runId"],
      "properties": {
        "type": { "const": "RUN_FINISHED" },
        "threadId": { "type": "string" },
        "runId": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "StepStartedEvent": {
      "type": "object",
      "required": ["type", "stepName"],
      "properties": {
        "type": { "const": "STEP_STARTED" },
        "stepName": { "type": "string" },
        "metadata": { "type": "object" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "StepFinishedEvent": {
      "type": "object",
      "required": ["type", "stepName"],
      "properties": {
        "type": { "const": "STEP_FINISHED" },
        "stepName": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "TextMessageStartEvent": {
      "type": "object",
      "required": ["type", "messageId", "role"],
      "properties": {
        "type": { "const": "TEXT_MESSAGE_START" },
        "messageId": { "type": "string" },
        "role": { "type": "string", "enum": ["user", "assistant"] },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "TextMessageContentEvent": {
      "type": "object",
      "required": ["type", "messageId", "delta"],
      "properties": {
        "type": { "const": "TEXT_MESSAGE_CONTENT" },
        "messageId": { "type": "string" },
        "delta": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "TextMessageEndEvent": {
      "type": "object",
      "required": ["type", "messageId"],
      "properties": {
        "type": { "const": "TEXT_MESSAGE_END" },
        "messageId": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "ToolCallStartEvent": {
      "type": "object",
      "required": ["type", "toolCallId", "toolCallName"],
      "properties": {
        "type": { "const": "TOOL_CALL_START" },
        "toolCallId": { "type": "string" },
        "toolCallName": { "type": "string" },
        "parentMessageId": { "type": ["string", "null"] },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "ToolCallArgsEvent": {
      "type": "object",
      "required": ["type", "toolCallId", "delta"],
      "properties": {
        "type": { "const": "TOOL_CALL_ARGS" },
        "toolCallId": { "type": "string" },
        "delta": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "ToolCallEndEvent": {
      "type": "object",
      "required": ["type", "toolCallId"],
      "properties": {
        "type": { "const": "TOOL_CALL_END" },
        "toolCallId": { "type": "string" },
        "result": { "type": ["string", "null"] },
        "error": { "type": ["string", "null"] },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "CustomEvent": {
      "type": "object",
      "required": ["type", "name", "value"],
      "properties": {
        "type": { "const": "CUSTOM" },
        "name": { "type": "string" },
        "value": { "type": "object" },
        "timestamp": { "type": "string", "format": "date-time" }
      }
    },
    "ToolApprovalRequestPayload": {
      "type": "object",
      "required": ["toolName", "toolDescription", "parameters", "reasoning", "riskLevel", "approvalId"],
      "properties": {
        "toolName": { "type": "string" },
        "toolDescription": { "type": "string" },
        "parameters": { "type": "object" },
        "reasoning": { "type": "string" },
        "riskLevel": { "$ref": "#/definitions/RiskLevel" },
        "approvalId": { "type": "string" }
      }
    },
    "ToolApprovalResponsePayload": {
      "type": "object",
      "required": ["approvalId", "approved"],
      "properties": {
        "approvalId": { "type": "string" },
        "approved": { "type": "boolean" },
        "feedback": { "type": ["string", "null"] }
      }
    },
    "ErrorPayload": {
      "type": "object",
      "required": ["errorCode", "message"],
      "properties": {
        "errorCode": { "type": "string" },
        "message": { "type": "string" },
        "details": { "type": ["object", "null"] }
      }
    }
  },
  "oneOf": [
    { "$ref": "#/definitions/RunStartedEvent" },
    { "$ref": "#/definitions/RunFinishedEvent" },
    { "$ref": "#/definitions/StepStartedEvent" },
    { "$ref": "#/definitions/StepFinishedEvent" },
    { "$ref": "#/definitions/TextMessageStartEvent" },
    { "$ref": "#/definitions/TextMessageContentEvent" },
    { "$ref": "#/definitions/TextMessageEndEvent" },
    { "$ref": "#/definitions/ToolCallStartEvent" },
    { "$ref": "#/definitions/ToolCallArgsEvent" },
    { "$ref": "#/definitions/ToolCallEndEvent" },
    { "$ref": "#/definitions/CustomEvent" }
  ]
}
