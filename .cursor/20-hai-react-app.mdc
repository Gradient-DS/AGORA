---
title: HAI React Application Rules
description: Cursor rules for building the Human Agent Interface (HAI) React application for AGORA
version: 3.0.0
status: implemented
tags: [react, typescript, accessibility, websocket, ag-ui]
last_updated: 2025-12
---

# HAI React Application - Development Rules

## Implementation Status ✅

**Version 3.0.0 - AG-UI Protocol Migration Complete**

The HAI application uses the AG-UI Protocol for communication with the LangGraph backend.

- ✅ Project structure and build configuration
- ✅ AG-UI Protocol types and Zod schemas (`@ag-ui/core`)
- ✅ AGUIWebSocketClient with auto-reconnect
- ✅ Zustand state management (AG-UI event structure)
- ✅ shadcn/ui components
- ✅ Chat interface with TEXT_MESSAGE_* events
- ✅ Tool call display with TOOL_CALL_* events
- ✅ Tool approval workflow (CUSTOM events)
- ✅ Layout components
- ✅ Accessibility features (WCAG 2.1 AA)
- ✅ Testing infrastructure
- ❌ Voice interface (Disabled/Removed for now)

**Total Files**: 50+ files
**Test Coverage**: 16 passing tests
**Linting**: Clean (0 errors, 0 warnings)
**Type Safety**: 100% TypeScript strict mode

## Development Workflow

When working on the HAI application, follow this workflow:

### 1. Planning Phase
- Define the feature or fix required
- Identify affected components and files
- Write tests first (TDD) for new features

### 2. Implementation Phase
- Create types/schemas first (in `src/types/`)
- Implement components following existing patterns
- Add accessibility attributes (ARIA, roles, labels)
- Use existing UI components from `src/components/ui/`

### 3. Testing Phase
```bash
# Run tests continuously during development
pnpm run test:watch

# Check specific test file
pnpm run test tests/unit/yourfile.test.ts
```

### 4. Quality Checks
```bash
# Type check
pnpm run type-check

# Lint code
pnpm run lint

# Fix auto-fixable issues
pnpm run lint:fix

# Run all checks
pnpm run type-check && pnpm run lint && pnpm run test
```

### 5. Visual Testing
```bash
# Start dev server
pnpm run dev

# Test in browser at http://localhost:3000
# - Check keyboard navigation
# - Test screen reader (VoiceOver/NVDA)
# - Verify WebSocket connection
```

### Order of Operations for New Features

1. **Write Tests** → `tests/unit/feature.test.ts`
2. **Create Types** → `src/types/` or inline interfaces
3. **Implement Component** → `src/components/feature/`
4. **Add to Store** (if needed) → `src/stores/useFeatureStore.ts`
5. **Create Hook** (if needed) → `src/hooks/useFeature.ts`
6. **Run Tests** → `pnpm run test`
7. **Type Check** → `pnpm run type-check`
8. **Lint** → `pnpm run lint`
9. **Visual Test** → `pnpm run dev`
10. **Document** → Update README/comments

## Project Overview

The Human Agent Interface (HAI) is a React-based web application that provides inspectors with an intuitive interface to interact with the AGORA multi-agent system via text. It features real-time communication with the Orchestrator backend via WebSocket.

### Tech Stack

#### Core Framework
- **React 18+**: Use functional components with hooks
- **TypeScript 5+**: Strict mode enabled
- **Vite**: Build tool and dev server
- **pnpm**: Package manager

#### UI & Styling
- **shadcn/ui**: Component library (install components as needed)
- **Tailwind CSS**: Utility-first CSS framework
- **Radix UI**: Unstyled accessible components (via shadcn)
- **Lucide React**: Icon library

#### State Management
- **Zustand**: Lightweight state management
  - Global app state (user session, connection status)
  - Message history store
  - Tool approval queue

#### Schema Validation
- **Zod**: Runtime type validation
  - Validate AG-UI Protocol messages
  - Validate WebSocket payloads
  - Type-safe environment variables

#### Testing
- **Vitest**: Unit test runner
- **React Testing Library**: Component testing
- **MSW (Mock Service Worker)**: Mock WebSocket connections

## Project Structure

```
HAI/
├── public/
├── src/
│   ├── components/
│   │   ├── ui/              # shadcn components
│   │   ├── chat/            # Chat interface components
│   │   ├── approval/        # Tool approval components
│   │   └── layout/          # Layout components
│   ├── lib/
│   │   ├── websocket/       # WebSocket client & AG-UI Protocol
│   │   └── utils/           # General utilities
│   ├── stores/              # Zustand stores
│   ├── hooks/               # Custom React hooks
│   ├── types/               # TypeScript types & schemas
│   ├── styles/              # Global styles
│   ├── App.tsx
│   └── main.tsx
├── tests/
├── package.json
└── README.md
```

## Code Style & Conventions

### TypeScript
- Use strict mode
- Prefer `interface` over `type` for object shapes
- Use `type` for unions, intersections, and primitives
- Export types from `types/` directory
- No `any` type (use `unknown` if needed)

### React Components
- Use functional components exclusively
- Use named exports for components
- One component per file (except tightly coupled sub-components)
- Props interface named `ComponentNameProps`
- Comments at the start of functions/components only

### State Management (Zustand)
- One store per domain/feature
- Store files named `use[Domain]Store.ts`
- Keep stores flat and normalized

### Schema Validation (Zod)
- Define schemas in `types/schemas.ts`
- Match AG-UI Protocol types from `server-langgraph/common/ag_ui_types.py`
- Use EventType enum for event discrimination

## AG-UI Protocol Implementation

### WebSocket Client
- Implement `AGUIWebSocketClient` in `lib/websocket/client.ts`
- Auto-reconnect with exponential backoff
- Message queue for offline messages
- Validate all incoming events with Zod

### Event Types
- **Lifecycle**: `RUN_STARTED`, `RUN_FINISHED`, `STEP_STARTED`, `STEP_FINISHED`
- **Text**: `TEXT_MESSAGE_START`, `TEXT_MESSAGE_CONTENT`, `TEXT_MESSAGE_END`
- **Tools**: `TOOL_CALL_START`, `TOOL_CALL_ARGS`, `TOOL_CALL_END`
- **Custom**: `CUSTOM` with `agora:*` names for approval flow
- Send user messages via `RunAgentInput` format

## Accessibility Requirements

### WCAG 2.1 AA Compliance
- All interactive elements keyboard accessible
- Proper focus management and visible focus indicators
- Sufficient color contrast (4.5:1 for normal text)
- Text resizable up to 200% without loss of functionality

## Voice & Audio Integration (DISABLED)

**Note:** Voice features are currently disabled in the frontend application.
- Voice-related components (`VoiceInterface`, `VoiceButton`) have been removed/disabled.
- `useVoiceMode` hook is inactive.
- Backend still supports `UnifiedVoiceHandler` for future use.

## Testing Strategy

### Unit Tests
- Test all custom hooks
- Test utility functions
- Test Zod schemas
- Test store actions and selectors

### Component Tests
- Test user interactions
- Test accessibility (ARIA attributes, keyboard navigation)
- Test conditional rendering
- Test error states

### Coverage Requirements
- Minimum 80% coverage for critical paths (WebSocket, Message Handling, Approval)

## Summary Checklist

When building the HAI React application, ensure:
- ✅ TypeScript strict mode enabled
- ✅ All shadcn/ui components installed
- ✅ Tailwind CSS configured
- ✅ Zustand stores created for state management
- ✅ Zod schemas match AG-UI Protocol types
- ✅ WebSocket client with auto-reconnect implemented
- ✅ All components keyboard accessible
- ✅ ARIA attributes on all interactive elements
- ✅ Unit tests for hooks, utilities, and stores
- ✅ Component tests for UI components
- ✅ Error boundaries in place
- ✅ Environment variables validated with Zod
- ✅ Responsive design (mobile, tablet, desktop)
